$.extend({adminSetup:function(n){$.extend($.adminSetting,n)},adminSetting:{addLogs:function(){},Pickers:{},DataApis:{}},adminTools:{renderControls:function(n,t,i){$.adminTools.renderPicker(n,t,i);$.adminTools.renderDatePicker(n,t,i);$.adminTools.renderSelect(n,t,i);$.adminTools.renderRadio(n,t,i);$.adminTools.renderCheckbox(n,t,i);$.adminTools.renderAutoComplete(n,t,i);$.adminTools.renderAutoComSelect(n,t,i)},renderPicker:function(n,t,i){var r=t.find("[data-control=picker]");$.each(r,function(){var t=$(this).attr("data-control-type"),r=$(this).attr("data-control-name");$(this).attr("data-url",$.adminSetting.Pickers[t]);$(this).picker("#"+n).change(i,r)})},renderDatePicker:function(n,t,i){var r=t.find("[data-control=datePicker]");$.each(r,function(){var n=$(this).attr("data-control-name");$(this).datePicker().change(i,n)})},renderSelect:function(n,t,i){var r=t.find("[data-control=bitSelect]");$.each(r,function(){var n=$(this).attr("data-control-type"),t=$(this).attr("data-control-name");$(this).attr("data-url",$.adminSetting.DataApis[n]);$(this).bitSelect().change(i,t)})},renderAutoComplete:function(n,t,i){var r=t.find("[data-control=bitAutoComplete]");$.each(r,function(){var n=$(this).attr("data-control-type"),t=$(this).attr("data-control-name");$(this).attr("data-url",$.adminSetting.DataApis[n]);$(this).bitAutoComplete().change(i,t)})},renderAutoComSelect:function(n,t,i){var r=t.find("[data-control=bitAutoComSelect]");$.each(r,function(){var n=$(this).attr("data-control-type"),t=$(this).attr("data-control-name");$(this).attr("data-url",$.adminSetting.DataApis[n]);$(this).bitAutoComSelect().change(i,t)})},renderRadio:function(n,t,i){var r=t.find("[data-control=bitRadio]");$.each(r,function(){var n=$(this).attr("data-control-type"),t=$(this).attr("data-control-name");$(this).attr("data-url",$.adminSetting.DataApis[n]);$(this).bitRadio().change(i,t)})},renderCheckbox:function(n,t){var i=t.find("[data-control=bitCheckbox]");$.each(i,function(){var n=$(this).attr("data-control-type"),t=$(this).attr("data-control-name");$(this).attr("data-url",$.adminSetting.DataApis[n]);$(this).bitCheckbox()})}}});$.fn.zk_filter=function(n){var i=n.jqFilter,t={getfilters:null};return t.getfilters=function(){var n={};return $.each(i.find("input,select"),function(){var i=$(this).attr("name"),r=$(this).attr("type"),t="";if(i!=undefined){switch(r){case"radio":t=$("input[name='"+i+"']:checked").val();break;case"checkbox":$("input[name='"+i+"']:checked").each(function(){t+=$(this).val()+","});t=t.substring(0,t.length-1);break;default:$(this).val()!=""&&(t=$(this).val())}t!=""&&t!=undefined&&t!="undefined"&&(n[i]=t)}}),n},t};$.fn.zk_table=function(n,t){var r=this,e={columns:[],initiaTBody:function(){},rows:null,isSelect:!1,sortable:function(){},formatter:null,update:null,Table:null},i=$.extend(e,n),o=function(n){var t={event:event,TableData:null,cancleCallback:function(){},queryCallback:function(){}},n=$.extend(t,n),u=this,i=function(){$("body").find(".querySuiteSearch").remove()},r=function(t){i();var r=$('<div class="querySuiteSearch"><\/div>').css("left",t.pageX-30).css("top",t.pageY+20),f=$('<div class="btnContnet"><\/div>'),e=$('<div class="btnClose">&times;<\/div>').bind("click",function(){r.remove();$.isFunction(n.cancleCallback)&&n.cancleCallback()});r.append(f.append(e));var o=$('<div class="inputContent"><\/div>'),u=$('<input type="text" placeholder="输入关键字" />'),s=$('<span class="btn btn-primary"">查询<\/span>').bind("click",function(){$.isFunction(n.queryCallback)&&(n.queryCallback(n.TableData,u.val()),r.remove())});r.append(o.append(u).append(s));$("body").append(r)};r(n.event)},s=function(n,i){o({event:i,queryCallback:function(i,r){t.column=n;t.keyword=r;t.query()}})},u;i.sortable=function(n,i){t.queryOrderType=i;t.queryOrderBy=n;t.refresh()};i.Table=$('<table class="table table-bordered table-hover"><\/table>');var h=function(){var n=$(r).find("thead"),t;i.Table.append(n);i.isSelect&&n.find('input[type="checkbox"]').change(function(){var t=$(this).prop("checked");n.parent().find("tbody").find(".SelectRow").prop("checked",t)});t=i.Table.find("thead").find("th");$.each(t,function(){var t=$(this).attr("data-search"),i=$(this).attr("data-field"),n;t=="true"&&(n=$('<span class="glyphicon glyphicon-filter" style="top:3px;cursor: pointer;"><\/span>'),$(this).append(n),n.bind("click",function(n){s(i,n)}))});$.each(t,function(){var r=$(this).attr("data-sortable"),n=$(this).attr("data-field"),t;r=="true"&&(t=$('<span class="querySuite-sortable glyphicon glyphicon-sort"><\/span>'),t.data("data","glyphicon-sort"),$(this).append(t),t.bind("click",function(){var r,u,t;if($(this).data("data")=="glyphicon-sort"){r=i.Table.find("thead").find(".querySuite-sortable");$.each(r,function(){$(this).data("data","glyphicon-sort");$(this).removeClass("glyphicon-sort-by-attributes-alt");$(this).removeClass("glyphicon-sort-by-attributes");$(this).addClass("glyphicon-sort")});t=i.Table.find("thead").find("th[data-field="+n+"]");t.find(".querySuite-sortable").removeClass("glyphicon-sort");t.find(".querySuite-sortable").addClass("glyphicon-sort-by-attributes-alt");t.find(".querySuite-sortable").data("data","glyphicon-sort-by-attributes-alt");u=$(".querySuite-sortable");$.each(u,function(){$(this).data("data","glyphicon-sort");$(this).removeClass("glyphicon-sort-by-attributes-alt");$(this).removeClass("glyphicon-sort-by-attributes");$(this).addClass("glyphicon-sort")});$(this).removeClass("glyphicon-sort");$(this).addClass("glyphicon-sort-by-attributes-alt");$(this).data("data","glyphicon-sort-by-attributes-alt");i.sortable(n,"desc");return}if($(this).data("data")=="glyphicon-sort-by-attributes-alt"){t=i.Table.find("thead").find("th[data-field="+n+"]");t.find(".querySuite-sortable").removeClass("glyphicon-sort-by-attributes-alt");t.find(".querySuite-sortable").addClass("glyphicon-sort-by-attributes");t.find(".querySuite-sortable").data("data","glyphicon-sort-by-attributes");$(this).addClass("glyphicon-sort-by-attributes");$(this).removeClass("glyphicon-sort-by-attributes-alt");$(this).data("data","glyphicon-sort-by-attributes");i.sortable(n,"asc");return}if($(this).data("data")=="glyphicon-sort-by-attributes"){t=i.Table.find("thead").find("th[data-field="+n+"]");t.find(".querySuite-sortable").removeClass("glyphicon-sort-by-attributes");t.find(".querySuite-sortable").addClass("glyphicon-sort-by-attributes-alt");t.find(".querySuite-sortable").data("data","glyphicon-sort-by-attributes-alt");$(this).addClass("glyphicon-sort-by-attributes-alt");$(this).removeClass("glyphicon-sort-by-attributes");$(this).data("data","glyphicon-sort-by-attributes-alt");i.sortable(n,"desc");return}}))})},f=function(n,r){var s,c,l,y,u;if(n!=null&&n.length>0)for(s=0;s<n.length;s++){var f=n[s],h=0,e=$("<tr><\/tr>");for(e.data("data",f),i.isSelect&&(u=i.Table.find("thead").find("th:eq("+h+")").attr("style"),u=u!=undefined?"stype='"+u+"'":"",c=$("<td "+u+'><input class="SelectRow" type="checkbox"><\/td>'),h++,c.find(".SelectRow").data("data",f),c.find(".SelectRow").change(function(){var i=$(this).prop("checked"),n;i==!1?t.jqTable.find("thead").find('input[type="checkbox"]').prop("checked",!1):(n=t.jqTable.find(".SelectRow:checked").length,n==t.pageSize&&t.jqTable.find("thead").find('input[type="checkbox"]').prop("checked",!0))}),e.append(c),e.bind("click",function(){$(this).siblings("tr").removeClass("Selected");$(this).addClass("Selected")})),l=0;l<i.columns.length;l++){var o=$("<td><\/td>"),a=i.columns[l],v=i.formatter[a];v==undefined?o.html(f[a]):(y=v(f[a],f),o.append(y));u=i.Table.find("thead").find("th:eq("+h+")").attr("style");u!=undefined&&(o.attr("style",u),u.indexOf("display:none")>-1&&o.show());h++;e.append(o)}r.find("tbody").append(e)}},c=function(n){i.Table.find("tbody").remove();i.Table.append($("<tbody><\/tbody>"));$.isFunction(i.initiaTBody)?i.initiaTBody(i.Table):f(i.rows,i.Table,n)};return i.updata=function(n){$("body").find(".querySuiteSearch").remove();i.Table.find("input[type=checkbox]").prop("checked",!1);i.Table.find("tbody").remove();i.Table.append($("<tbody><\/tbody>"));f(n,i.Table,!1);i.resize()},i.getSelect=function(){var t=i.Table.find(".SelectRow:checked"),r=[],n,u;if(t.length>0)for(n=0;n<t.length;n++)u=t[n],r.push($(u).data("data"));return r},i.resize=function(){var n=$("<div><\/div>");n.append(i.Table);$(r).html("");$(r).append(n)},$(window).resize(function(){i.resize()}),h(),c(!0),u=$("<div><\/div>"),u.append(i.Table),$(r).html(""),$(r).append(u),i};$.fn.zk_paging=function(n){var s=this,h={pageSize:10,pageIndex:1,pageShow:10,totalContent:1001,onPageIndexChange:function(n){alert(n)},onPageSizeChange:function(){}},t=$.extend(h,n),r=Math.ceil(t.totalContent/t.pageSize),i,o,u,f;$(s).html("");var e=$('<table style="width:100%;"><tr><\/tr><\/table>'),c=(t.pageIndex-1)*t.pageSize+1,l=c+t.pageSize-1;t.pageIndex==r&&(l=t.totalContent<=t.pageShow?t.totalContent:t.totalContent);r<1&&(r=1);i=$('<td style="vertical-align: middle;"><span>当前 '+t.pageIndex+" / "+r+' 页，每页<input type="text" class="pageSize" title="离开此文本自动设置" style="width:40px;height: 20px;text-align: center; margin:0px 5px;border: #d2d6de 1px solid;border-radius: 4px;" value="'+t.pageSize+'" />条                        ,总共 '+t.totalContent+" 条记录<\/span><\/td>");i.find(".pageSize").bind("keydown",function(n){var t=n||window.event||arguments.callee.caller.arguments[0];t&&t.keyCode==13&&$(this).blur()});i.find(".pageSize").bind("blur",function(){if(t.pageSize!=i.find(".pageSize").val()&&((isNaN(parseFloat(i.find(".pageSize").val()))||parseFloat(i.find(".pageSize").val())<=0)&&i.find(".pageSize").val(10),t.pageIndex=1,t.pageSize=parseInt(i.find(".pageSize").val()),$.isFunction(t.onPageSizeChange)))t.onPageSizeChange(t.pageIndex,t.pageSize)});e.append(i);o=$('<td style="text-align:right"><nav class="pageNum"><\/nav><\/td>');u=$('<ul class="pagination" style="margin: 5px 0px;">');o.find("nav").append(u);e.append(o);f=function(){var o,i,s,n,e,h;for(u.html(""),o=$('<li><a href="javascript:void(0);">&laquo;<\/a><\/li>'),u.append(o),o.bind("click",function(){if(t.pageIndex=1,$.isFunction(t.onPageIndexChange))t.onPageIndexChange(t.pageIndex);f()}),i=1,s=r,t.pageIndex>=t.pageShow&&(i=t.pageIndex-Math.ceil(t.pageShow/2)),s=i+t.pageShow>=r?r:i+t.pageShow-1,n=i;n<=s;n++)e=$('<li><a href="javascript:void(0);">'+n+"<\/a><\/li>"),e.data("index",n),n==t.pageIndex&&e.addClass("active"),e.bind("click",function(){if(t.pageIndex=$(this).data("index"),$.isFunction(t.onPageIndexChange))t.onPageIndexChange(t.pageIndex);f()}),u.append(e);h=$('<li><li><a href="javascript:void(0);">&raquo;<\/a><\/li><\/li>');u.append(h);h.bind("click",function(){if(t.pageIndex=r,$.isFunction(t.onPageIndexChange))t.onPageIndexChange(t.pageIndex);f()})};f();$(s).append(e)};$.fn.querySuite=function(n){function nt(n){return _column={},_column.format=function(i){return $.isFunction(i)&&(s[n]=i),t},_column}function g(n,i,r){return _input={},_input.change=function(u){return $.isFunction(u)&&(i&&(t.changes[r]=u),n.change(u)),t},_input}var f=$(this),i=f.find(".querySuite-filter"),e=f.find(".querySuite-button"),r=f.find(".querySuite-table"),k=f.find(".querySuite-paging"),t,h,o,c,l,a,v,u,y,p,w,b,d,s;if(i.addClass("container-fluid"),e.addClass("container-fluid"),t={jqFilter:i,jqButton:e,jqTable:r,jqPaging:k,query:null,queryUrl:null,"delete":null,deleteUrl:null,"export":null,exportUrl:null,refresh:null,columnsKey:[],key:null,pageIndex:1,pageSize:null},$.extend(t,n),t.queryUrl=r.attr("data-query-url"),h=r.attr("data-order-by"),h!=undefined&&(o=h.split(" "),t.queryOrderBy=o[0],t.queryOrderType=o.length==2?o[1]:""),t.deleteUrl=r.attr("data-delete-url"),t.sortUrl=r.attr("data-sort-url"),t.importUrl=r.attr("data-import-url"),t.exportUrl=r.attr("data-export-url"),t.key=r.attr("data-key"),t.pageSize=k.attr("data-page-size"),(t.pageSize=="undefined"||t.pageSize==undefined)&&(t.pageSize=10),t.pageSize=parseInt(t.pageSize),$("[action=import]").length>0&&t.importUrl){c=$('<input style="display:none;" type="file" class="queryImport" />');$("[action=import]").before(c).on("click",function(){$(".queryImport").click()});c.fileupload({url:t.importUrl,autoUpload:!0,add:function(n,t){var r=t.files[0].name.toLowerCase(),i=r.substring(r.lastIndexOf("."));if(i!=".xlsx"&&i!=".xls"&&i!=".txt")return alert("文件类型错误，请选择 xls,xlsx,txt 类型文件!"),!1;t.submit()},success:function(n){n.code==0?$.isFunction(b)?b(n):alert(n.msg):alert(n.msg)},error:function(){alert("数据文件导入失败，请稍后重试！")}})}return i.find("tr").length>1&&(i.find("tr").addClass("tr_shrink").hide(),i.find("tr:eq(0)").removeClass("tr_shrink").show(),i.find("tr").append("<td><\/td>"),l=$('<button type="button" class="btn btn-link"><span class="glyphicon glyphicon-zoom-in"><\/span> 高级查询<\/button>').bind("click",function(){i.find(".tr_shrink").animate({height:"toggle",opacity:"toggle"},"slow");$(this).css("display","none");a.css("display","block")}),a=$('<button type="button" class="btn btn-link"><span class="glyphicon glyphicon-zoom-out"><\/span> 高级查询<\/button>').bind("click",function(){i.find(".tr_shrink").animate({height:"toggle",opacity:"toggle"},"slow");$(this).css("display","none");l.css("display","block")}).hide(),i.find("tr:eq(0)").find("td:last").append($("<span><\/span>").append(l).append(a))),v=i.zk_filter(t),t.GetData=function(){var n=null,i={offset:(t.pageIndex-1)*t.pageSize,limit:t.pageSize,ordertype:t.queryOrderType,orderby:t.queryOrderBy,condition:t.keyword,column:t.column,r:(new Date).getTime()},r=v.getfilters();return $.extend(i,r),$.ajax({url:t.queryUrl,async:!1,data:i,type:"post",success:function(i){n=i;t.jqPaging.zk_paging({pageSize:t.pageSize,pageIndex:t.pageIndex,totalContent:i.total,onPageIndexChange:function(n){t.pageIndex=n;t.refresh()},onPageSizeChange:function(n,i){t.pageIndex=n;t.pageSize=i;t.refresh()}})}}),n},t.query=function(n){return $.isFunction(n)?(y=n,t):u?(t.pageIndex=1,t.refresh()):(u=r.zk_table({columns:t.columnsKey,isSelect:d,formatter:s},t),u.updata(t.GetData().data),t.sortUrl!=undefined&&t.sortUrl!=""&&t.sortable(),t)},t.refresh=function(){return u.updata(t.GetData().data),$.isFunction(y)&&y(),t.sortUrl!=undefined&&t.sortUrl!=""&&t.sortable(),t},t.sortable=function(n){return $.isFunction(n)?(p=n,t):(t.jqTable.find("tbody").sortable({helper:function(n,t){var r=t.children(),i=t.clone();return i.children().each(function(n){$(this).width(r.eq(n).width())}),i},stop:function(n,i){$("td.index",i.item.parent()).each(function(n){$(this).html(n+1)});var r=[],u=t.key.split(",");t.jqTable.find("tbody tr").each(function(n,t){var t=$(this).data("data"),i="";$.each(u,function(n,r){i!=""&&(i+="_");i+=t[r]});i!=""&&r.push(i)});$.post(t.sortUrl,{ids:r.toString()},function(n){n&&n.code==0&&$.isFunction(p)&&p(r)})}}).disableSelection(),t)},t.delete=function(n){var f,i;if($.isFunction(n))w=n;else{var e=u.getSelect(),r=[],o=t.key.split(",");for(f=0;f<e.length;f++)i="",$.each(o,function(n,t){i!=""&&(i+="_");i+=e[f][t]}),i!=""&&r.push(i);if(r.length==0){alert("请选择要删除的项");return}confirm("您确定要删除所选内容吗？")&&$.post(t.deleteUrl,{ids:r.toString()},function(n){n&&n.code==0&&($.adminSetting.addLogs($(document).attr("title"),"删除","删除数据"+r.toString()),t.query());alert(n.msg);$.isFunction(w)&&w(n)})}return t},t.import=function(n){return $.isFunction(n)&&(b=n),t},t.export=function(){var n={r:(new Date).getTime()},u=v.getfilters(),i,r;$.extend(n,u);i=$("<form><\/form>").attr("action",t.exportUrl).attr("method","post");for(r in n)i.append($("<input><\/input>").attr("type","hidden").attr("name",r).attr("value",n[r]));return i.appendTo("body").submit().remove(),t},t.getSelect=function(){return u.getSelect()},d=r.find("input[type=checkbox]").length>0,s={},t.columns={},$.each(t.jqTable.find("th"),function(n,i){var u=$(i).attr("data-field"),r;u!="undefined"&&u!=undefined&&(t.columnsKey.push(u),t.columns[u]=nt(u));r=$(i).attr("data-format");r!="undefined"&&r!=undefined&&(s[u]=function(n,i){var u,f;return r.indexOf("time|")==0||r=="time"?(u=r.split("|"),u.length==2)?time.format(n,u[1]):time.format(n,"yyyy-MM-dd hh:mm:ss"):r.indexOf("edit|")==0||r=="edit"?(f=$('<span class="btn btn-link">'+n+"<\/span>"),f.bind("click",function(){var n=r.split("|");n.length==1&&n.push($(".formSuite-wrapper").attr("id"));var f=$("#"+n[1]+' [data-action="loadform"]'),e=t.key.split(","),u={};$.each(e,function(n,t){u[t]=i[t]});f.attr("data-param",JSON.stringify(u)).click()}),f):void 0})}),e.find("[action='query']").click(function(){t.column="";t.keyword="";t.query()}),e.find("[action='delete']").click(function(){t.delete()}),e.find("[action='export']").click(function(){t.export()}),t.controls={},t.changes={},$.each(t.jqFilter.find("input,select"),function(n,i){var r=$(i).attr("name");r!="undefined"&&r!=undefined&&(t.controls[r]=g($(i)))}),$.each(t.jqFilter.find("[data-control-name]"),function(n,i){t.controls[key]=g($(i),!0,$(i).attr("data-control-name"))}),$.adminTools.renderControls(f.attr("id"),i,t.changes),t};$.fn.formSuite=function(n){function v(n,i,r){return _input={},_input.change=function(u){return $.isFunction(u)&&(i?t.changes[r]=u:n.change(u)),t},_input}var r=$(this),y=$('<div class="modal-header">        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;<\/button>        <h4 class="modal-title"><\/h4><\/div>'),f,e,t,u,o,s,h,a,c;r.find(".modal-content:first").children(".modal-header").length==0&&y.insertBefore(r.find(".modal-body:first"));f=r.attr("id")+"H4";e=r.find(".modal-title").attr("id",f);r.attr("aria-labelledby",f).attr("tabindex","-1");var i=r.find("form"),p=$("[action-modal="+r.attr("id")+"]").attr("data-toggle","modal").attr("data-target","#"+r.attr("id")).click(function(){t.add()}),w=r.find("[action=save]").click(function(){t.submit()}),l=$('<span data-action="loadform"><\/span>');return l.click(function(){t.load(JSON.parse($(this).attr("data-param")))}),r.append(l),t={jqModal:r,jqForm:i},$.extend(t,n,{title:i.attr("data-title"),submitClose:i.attr("data-submit-close"),loadFormUrl:i.attr("data-load-url"),saveFormUrl:i.attr("data-save-url")}),u=!1,t,t.add=function(n){return $.isFunction(n)?o=n:(t.reset(),$.isFunction(o)&&o()),t},t.valid=function(){return i.valid()},t.save=function(n){if($.isFunction(n))s=n;else if(!u){u=!0;$.showLoading();var r=i.formSerialize();$.post(t.saveFormUrl,r,function(n){n.code==0?$.isFunction(s)&&s(n):alert(n.msg);u=!1;$.hideLoading()})}return t},t.submit=function(n){return $.isFunction(n)?h=n:(i.validate(a),i.submit()),t},a={submitHandler:function(){if(u)return!1;u=!0;$.showLoading();var n=i.formSerialize();return $.post(t.saveFormUrl,n,function(f){f.code==0?($.adminSetting.addLogs($(document).attr("title"),logType!="edit"?"新增":"编辑",n),t.submitClose!="false"&&(r.modal("hide"),i.resetForm()),$.isFunction(h)&&h(f)):alert(f.msg);u=!1;$.hideLoading()}),!1}},t.reset=function(){return i.resetForm(),i.find("input[type=hidden]").val(""),i.find("label[class^=error]").remove(),i.find(".error").removeClass("error"),$.each(i.find("input,select"),function(){var n,t;($(this).attr("class")!=undefined&&$(this).attr("class").indexOf("required")>-1||$(this).attr("required"))&&(n=$(this).parent().prev(),n.is("th")||(n=$(this).parent().parent().prev()),t=n.text(),n.html('<label id="'+$(this).attr("name")+'-error" class="error error-lab" for="'+$(this).attr("name")+'">*<\/label>'+t))}),logType="add",e.text("新增"+t.title),t},t.edit=function(n){return $.isFunction(n)?c=n:(t.reset(),r.modal("show"),$.showLoading(),logType="edit",e.text("修改"+t.title),$.ajax({type:"post",url:t.loadFormUrl,datatype:"json",data:n,success:function(n){var t,r,a,o,f,s,u,e,h,l;for(t in n.data)if(r=i.find(" [name='"+t+"']"),r.length>0){a=r.attr("name");o=r.attr("type");switch(o){case"radio":i.find("input[name='"+t+"'][value='"+n.data[t]+"']").prop("checked","checked");r.parent().attr("data-actualval",n.data[t]);break;case"checkbox":if(r.parent().attr("data-actualval",n.data[t]),n.data[t]!=null&&n.data[t].toString()!=""){f=n.data[t].toString().split(",");i.find("input[name='"+t+"']").removeAttr("checked");for(s in f)i.find("input[name='"+t+"'][value='"+f[s]+"']").prop("checked","checked")}break;default:if(u=n.data[t],r[0].tagName=="SELECT"){r.attr("data-actualval",u);r.val(u);continue}e=r.parent();h=e.attr("data-control");h=="datePicker"&&(l=e.attr("data-format"),u=time.format(u,l));r.val(u)}}$.hideLoading();$.isFunction(c)&&c(n)},error:function(){$.hideLoading()}})),t},t.load=function(n){return n?t.edit(n):t.add(),t},t.controls={},t.changes={},$.each(t.jqForm.find("input,select"),function(n,i){var r=$(i).attr("name");r!="undefined"&&r!=undefined&&(t.controls[r]=v($(i)))}),$.each(t.jqForm.find("[data-control-name]"),function(n,i){t.controls[$(i).attr("data-control-name")]=v($(i),!0,$(i).attr("data-control-name"))}),$.adminTools.renderControls(r.attr("id"),i,t.changes),t};$.fn.generalForm=function(n){function c(n,i,r){return _input={},_input.change=function(u){return $.isFunction(u)&&(i?t.changes[r]=u:n.change(u)),t},_input}var u=$(this),i=u.find("form"),l=u.find("[action=save]").click(function(){t.submit()}),t={jqModal:u,jqForm:i,loadFormUrl:i.attr("data-load-url"),saveFormUrl:i.attr("data-save-url")},r,f,e,o,h,s;return $.extend(t,n),r=!1,t.add=function(n){return $.isFunction(n)?f=n:(t.reset(),$.isFunction(f)&&f()),t},t.valid=function(){return i.valid()},t.save=function(n){if($.isFunction(n))e=n;else{if(r)return t;r=!0;$.showLoading();$.post(t.saveFormUrl,i.formSerialize(),function(n){n.code==0?$.isFunction(e)&&e(n):alert(n.msg);r=!1;$.hideLoading()})}return t},t.submit=function(n){return $.isFunction(n)?o=n:(i.validate(h),i.submit()),t},h={submitHandler:function(){if(r)return!1;r=!0;$.showLoading();var n=i.formSerialize();return $.post(t.saveFormUrl,n,function(t){t.code==0?($.adminSetting.addLogs($(document).attr("title"),logType!="edit"?"新增":"编辑",n),$.isFunction(o)&&o(t)):alert(t.msg);r=!1;$.hideLoading()}),!1}},t.reset=function(){return i.resetForm(),i.find("input[type=hidden]").val(""),i.find("label[class^=error]").remove(),i.find(".error").removeClass("error"),$.each(i.find("input,select"),function(){var n,t;($(this).attr("class")!=undefined&&$(this).attr("class").indexOf("required")>-1||$(this).attr("required"))&&(n=$(this).parent().prev(),n.is("th")||(n=$(this).parent().parent().prev()),t=n.text(),n.html('<label id="'+$(this).attr("name")+'-error" class="error error-lab" for="'+$(this).attr("name")+'">*<\/label>'+t))}),logType="add",t},t.edit=function(n){return $.isFunction(n)?s=n:(t.reset(),$.showLoading(),logType="edit",$.ajax({type:"post",url:t.loadFormUrl,datatype:"json",data:n,success:function(n){var t,r,a,o,f,h,u,e,c,l;for(t in n.data)if(r=i.find(" [name='"+t+"']"),r.length>0){a=r.attr("name");o=r.attr("type");switch(o){case"radio":i.find("input[name='"+t+"'][value='"+n.data[t]+"']").prop("checked","checked");r.parent().attr("data-actualval",n.data[t]);break;case"checkbox":if(r.parent().attr("data-actualval",n.data[t]),n.data[t]!=null&&n.data[t].toString()!=""){f=n.data[t].toString().split(",");i.find("input[name='"+t+"']").removeAttr("checked");for(h in f)i.find("input[name='"+t+"'][value='"+f[h]+"']").prop("checked","checked")}break;default:if(u=n.data[t],r[0].tagName=="SELECT"){r.attr("data-actualval",u);r.val(u);continue}e=r.parent();c=e.attr("data-control");c=="datePicker"&&(l=e.attr("data-format"),u=time.format(u,l));r.val(u)}}$.hideLoading();$.isFunction(s)&&s(n)},error:function(){$.hideLoading()}})),t},t.load=function(n){return n?t.edit(n):t.add(),t},t.controls={},t.changes={},$.each(t.jqForm.find("select:not([data-control-name]),input:not([data-control-name])"),function(n,i){var r=$(i).attr("name");r!="undefined"&&r!=undefined&&(t.controls[r]=c($(i)))}),$.each(t.jqForm.find("[data-control-name]"),function(n,i){t.controls[$(i).attr("data-control-name")]=c($(i),!0,$(i).attr("data-control-name"))}),$.adminTools.renderControls(u.attr("id"),i,t.changes),t};